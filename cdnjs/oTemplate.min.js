// oTemplate.min.js#1.0.0-beta - 2015-09-12 14:06:50
~function(a){"use strict";function b(a,b){if(h(b)){var c=new XMLHttpRequest;c.onreadystatechange=function(){this.DONE===this.readyState&&b(this.responseText)},c.onerror=c.ontimeout=c.onabort=function(){b("")},c.open("GET",a,!0),c.send(null)}}function c(a,b){return(a.substr(0,b).match(/\n/g)||[]).length+1}function d(a){return Object.prototype.toString.call(a)}function e(a){return"undefined"!=typeof a}function f(a){return"undefined"==typeof a}function g(a){return"[object Object]"===d(a)}function h(a){return"[object Function]"===d(a)}function i(a){return"[object Number]"===d(a)}function j(a){return"[object Boolean]"===d(a)}function k(a){return"[object String]"===d(a)}function l(a){return"[object RegExp]"===d(a)}function m(a){return"[object Array]"===d(a)}function n(a){var b,c;return!1===g(a)||f(a)?!1:(b=a.constructor,"function"!=typeof b?!1:(c=b.prototype,!1===g(c)?!1:!1===c.hasOwnProperty("isPrototypeOf")?!1:!0))}function o(a,b,c){if(!k(a))return void 0;for(var d=b,e=a.split(c||"."),g=0,h=e.length;h>g;g++){if(f(d[e[g]]))return void 0;d=d[e[g]]}return f(d)?void 0:d}function p(a){return k(a)?a:i(a)?a+="":h(a)?p(a.call(a)):""}function q(a){return a.replace(/("|'|\\)/g,"\\$1").replace(/\r/g,"\\r").replace(/\n/g,"\\n")}function r(a,b){if(h(b)){var c;if(m(a))if(Array.prototype.some)a.some(b);else{var d=a.length;for(c=0;d>c&&!0!==b(a[c],c);c++);}else if(g(a))for(c in a)if(!0===b(a[c],c))break}}function s(a){for(var b={},c=[],d=a.length;d--;)b.hasOwnProperty(a[d])||(c.push(a[d]),b[a[d]]=1);return c}function t(a,b){var c=m(a),d=c?[]:{};return r(a,function(a,e){b(a,e)&&(d[c?d.length:e]=a)}),d}function u(a,b){if(arguments.length>2){a=u(a,b);var c=Array.prototype.slice.call(arguments,2,arguments.length);return u(a,c[0])}if(m(a)&&m(b))Array.prototype.splice.apply(a,[a.length,0].concat(b));else if(n(a)&&n(b))for(var d in b)a[d]=b[d];return a}function v(a){if(e(console)&&h(console.error)){var b="";g(a)?r(a,function(a,c){b+="<"+c+">\n"+a+"\n\n"}):k(a)&&(b=a),console.error(b)}}function w(){return""}function x(a,b,c){"function"==typeof define?define(function(){return b(c)}):"object"==typeof exports?module.exports=b(c):c[a]=b(c)}var y=function(a){a=a||{};var b=this;this._caches={},this._blocks={},this._blockHelpers={},this._helpers={},this._defaults={},u(this._defaults,y._defaults,a),h(y._extends)&&this["extends"](y._extends),~u(this._helpers,{include:function(a,c,d){return b.renderById(a,c,d)},escape:function(){var a={};return a.SOURCES={"<":"&lt;",">":"&gt;","&":"&amp;",'"':"&quot;","'":"&#x27;","/":"&#x2f;"},a.escapeFn=function(a){return this.SOURCES[a]},a.escape=function(a){return p(a).replace(/&(?![\w#]+;)|[<>"']/g,this.escapeFn)},function(){return a.escape.apply(a,arguments)}}()})};y._defaults={env:"produce",noSyntax:!1,strict:!0,compress:!0,openTag:"{{",closeTag:"}}",depends:[]},y.prototype.$$throw=function(a){"unit"!==this._defaults.env&&v(a)},y.prototype.$$cache=function(a,b){var c=this._caches;return arguments.length>1?(c[a]=b,this):c[a]},y.prototype.$$table=function(){function a(a,b,c){c=c||" ",a=a.toString(),b=b.toString().replace(/\d/g,c);var d=b.split("");return d.splice(-a.length,a.length,a),d.join("")}return function(b){var c=0,d=b.match(/([^\n]*)?\n|([^\n]+)$/g);if(!d)return c+" | "+b;var e=d.length;return b.replace(/([^\n]*)?\n|([^\n]+)$/g,function(b){return a(++c,e)+" | "+b})}}(),y.prototype.$compileShell=function(){function b(a){var b=["$data","$helper","$buffer","$runtime","$append","abstract","arguments","break","boolean","byte","case","catch","char","class","continue","console","const","debugger","default","delete","do","double","else","enum","export","extends","false","final","finally","float","for","function","goto","if","implements","import","in","instanceof","int","interface","let","long","native","new","null","package","private","protected","public","return","short","static","super","switch","synchronized","this","throw","throws","transient","true","try","typeof","undefined","var","void","volatile","while","with","yield"],c=a.replace(/\\?\"([^\"])*\\?\"|\\?\'([^\'])*\\?\'|\/\*[\w\W]*?\*\/|\/\/[^\n]*\n|\/\/[^\n]*$|\s*\.\s*[$\w\.]+/g,"").replace(/[^\w$]+/g,",").replace(/^\d[^,]*|,\d[^,]*|^,+|,+$/g,"").split(/^$|,+/);return t(c,function(a){return-1===b.indexOf(a)})}return function(c,d){d=j(d)?d:this._defaults.compress;var e=this._helpers,f=this._blockHelpers,g=[],i=[],k=[],l=1,m="",n=function(a){return a=a.replace(/<!--[\w\W]*?-->/g,"").replace(/^ +$/,""),""===a?"":(l+=a.split(/\n/).length-1,a=a.replace(/(["'\\])/g,"\\$1"),a=!0===d?a.replace(/[\r\t\n]/g,"").replace(/ +/g," "):a.replace(/\t/g,"\\t").replace(/\r/g,"\\r").replace(/\n/g,"\\n"),'$buffer+="'+a+'";')},o=function(c){return r(b(c),function(b){if(b){var c=a[b];if(!h(c)||!c.toString().match(/^\s*?function \w+\(\) \{\s*?\[native code\]\s*?\}\s*?$/i))return h(e[b])?void g.push(b):h(f[b])?void i.push(b):void k.push(b)}}),/^=\s*[\w]+?\s*$/.exec(c)?c="$buffer+=("+c.replace(/[=\s;]/g,"")+')||"";':/^\s*\w+\s*\([^\)]*?\)\s*$/.exec(c)&&(c="$buffer+="+c+'||"";'),l+=c.split(/\n/).length-1,c+="$runtime="+l+";"};return c=c||"",r(c.split("<%"),function(a){a=a.split("%>");var b=a[0],c=a[1];1===a.length?m+=n(b):(m+=o(b),m+=n(c))}),r(s(k),function(a){m="var "+a+"=$data."+a+";"+m}),r(s(g),function(a){m="var "+a+"=$helpers."+a+";"+m}),r(s(i),function(a){m="var "+a+"=$blocks."+a+";"+m}),m='try {"use strict";var $scope=this,$helpers=$scope.$helpers,$blocks=$scope.$blocks,$buffer="",$runtime=0;'+m+'return $buffer;}catch(err) {throw {message: err.message,line: $runtime,shell: "'+q(this.$$table(c))+'"};}function $append(buffer) {$buffer += buffer}'}}(),y.prototype.$compile=function(){function a(a,b,c){var d;try{d=new Function(b,a)}catch(e){v({message:"[Build Render]: "+e.message,line:"Anonymous function can not find out the error line.",template:source,shell:a}),d=w}return function(){try{return d.apply(c,arguments)}catch(a){a=u({},a,{source:c.$source}),v({message:"[Exec Render]: "+a.message,line:a.line,source:a.source,shell:a.shell})}}}return function(b,c){var d=b,e=u({},this._defaults,c),f=["$data"].concat(e.depends).join(",");!0!==e.noSyntax&&(b=this.$compileSyntax(b,!!e.strict));var g=this.$compileShell(b);return a(g,f,{$source:this.$$table(d),$helpers:this._helpers,$blocks:this._blockHelpers})}}(),y.prototype.OTemplate=function(a){return new y(a)},y.prototype["extends"]=function(a){return a.call(this,this),this},y.prototype.config=function(a,b){if(1<arguments.length&&k(a))return"openTag"===a&&"<%"===a||"closeTag"===a&&"%>"===a?this:(this._defaults[a]=b,this);var c=this;return n(a)?(r(options,function(a,b){c.config(a,b)}),this):k(a)?this._defaults[a]:void 0},y.prototype.helper=function(a,b){if(1<arguments.length)k(a)&&h(b)&&(this._helpers[a]=b);else{if(k(a))return this._helpers[a];if(n(a)){var c;for(c in a)this.helper(c,a[c])}}return this},y.prototype.unhelper=function(a){var b=this._helpers;return b.hasOwnProperty(a)&&delete b[a],this},y.prototype.compile=function(a,b){a=a.toString();var c=u({},this._defaults,b),d=c.filename,e=!0===c.overwrite||this.$$cache(d);return h(e)?e:(e=this.$compile(a,c),k(d)&&this.$$cache(d,e),e)},y.prototype.render=function(a,b,c){return this.compile(a,c)(b||{})},y._defaults=u(y._defaults,{noSyntax:!1}),y.prototype.$$compile=function(a,b){return b=n(b)?b:this._defaults,a.replace(/<%=\s*([^\s]+)?\s*%>/gim,function(a,c){return o(c,b)||""})},y.prototype.$$compileRegexp=function(a,b){var c=this.$$compile(a);return new RegExp(c,b)},y.prototype.$registerSyntax=function(a,b,c){var d=this;return 2<arguments.length?this._blocks[a]={syntax:l(b)?b:this.$$compileRegexp("<%= openTag %>"+b+"<%= closeTag %>","igm"),shell:h(c)?c:"<%"+this.$$compile(c)+"%>"}:n(b)?r(b,function(b,c){d.$registerSyntax(a,c,b)}):m(b)&&r(b,function(b){k(b.syntax)&&k(b.shell)||h(b.shell)&&d.$registerSyntax(a,b.syntax,b.shell)}),this},y.prototype.$unregisterSyntax=function(a){var b=this._blocks;return b.hasOwnProperty(a)&&delete b[a],this},y.prototype.$clearSyntax=function(a){var b=this.$$compileRegexp("<%= openTag %>(.*)?<%= closeTag %>","igm");return a.replace(b,"")},y.prototype.$analyzeSyntax=function(a,b){b=!(!1===b);var d=a;b&&r(this._blocks,function(a){d=d.replace(a.syntax,"")});var e=this.$$compileRegexp("<%= openTag %>|<%= closeTag %>","igm"),f=this.$clearSyntax(d);if(j=f.search(e),-1!==j){var g=c(f,j);return{message:"[Syntax Error]: Syntax error in line "+g+".",template:this.$$table(a)}}var h=this.$$compileRegexp("<%= openTag %>(.*)?<%= closeTag %>","igm"),i=a.match(h);if(i){var j=d.search(h),g=c(d,j);return{message:"[Syntax Error]: `"+i[0]+"` did not match any syntax in line "+g+".",template:this.$$table(d)}}return!0},y.prototype.$compileSyntax=function(a,b){b=!(!1===b);var c;this._defaults;return r(this._blocks,function(b){a=a.replace(b.syntax,b.shell)}),b?!0===(c=this.$analyzeSyntax(a,!1))?a:this.$$throw(c)||"":this.$clearSyntax(a)},y.prototype.block=function(a,b){if(1<arguments.length)k(a)&&h(b)&&(this.$registerSyntax(a+"open","("+a+")\\s*([\\w\\s,\\\"\\']+)?\\s*(:\\s*([,\\w\\s]+)?)?",'$1($2, $append, function($4) {var $buffer="";').$registerSyntax(a+"close","/"+a,"return $buffer;});")._blockHelpers[a]=b);else{if(k(a))return this._blockHelpers[a];if(n(a)){var c;for(c in a)this.block(c,a[c])}}return this},y.prototype.unblock=function(a){var b=this._blockHelpers;return helpers.hasOwnProperty(a)&&(delete helpers[a],delete b[a+"open"],delete b[a+"close"]),this},y._extends=function(){var a="\\s*([^\\s\\|]+)?\\s*\\|\\s*([\\w]+)?(:([,\\w]+)?)?(.*)",b=this.$$compileRegexp(a);this.$registerSyntax("echo","@\\s*([^<%= closeTag %>]+)?\\s*","=$1").$registerSyntax("ifopen","if\\s*(.+)?\\s*","if($1) {").$registerSyntax("else","else","} else {").$registerSyntax("elseif","else\\s*if\\s*(.+)?\\s*","} else if($1) {").$registerSyntax("ifclose","\\/if","}").$registerSyntax("eachopen","each\\s*([^\\s]+)?\\s*(as\\s*(\\w*?)\\s*(,\\s*\\w*?)?)?\\s*",function(a,b,c,d,e){var f="each("+b+", function("+(d||"$value")+(e||", $index")+") {";return"<%"+f+"%>"}).$registerSyntax("eachclose","\\/each","})").$registerSyntax("include","include\\s*([^\\s,]+)?\\s*(,\\s*[^\\s+]+)?\\s*","include($1$2)").$registerSyntax("escape","#\\s*([^\\s]+)?\\s*","escape($1)").$registerSyntax("helper",a,function(){function a(a,b,c,d,e,f){return c+"("+b+(e?","+e:"")+")"+(f?f.replace(/^\s*$/,""):"")}return function(c,d,e,f,g,h){for(var i=a.apply(this,arguments);b.exec(i);)i=i.replace(b,a);return"<%"+i+"%>"}}()),~u(this._helpers,{each:function(a,b){r(a,b)}})},y.prototype.compileById=function(a,b){a=a.toString();var c=u({},this._defaults,b),d=!0===c.overwrite||this.$$cache(a);if(h(d))return d;var e=document.getElementById(a);return e?this.compile(e.innerHTML,{filename:a},c):v({message:"[Compile Template]: template `"+a+"` is not found."})||w},y.prototype.renderById=function(a,b,c){var d=this.compileById(a,c);return d(b||{})},y.prototype.compileByAjax=function(a,c,d){if(h(c)){var e=this,f=u({},this._defaults,d),g=!0===f.overwrite||this.$$cache(a);h(g)?c(g):b(a,function(b){for(var d,h=b,i=[];d=/<%\s*include\s*\(\s*(\'([^\']+)?\'|\"([^\"]+)?\")((,\s*([\w]+|\{[\w\W]+\})\s*)*)\s*\)\s*%>/.exec(h);)i.push(d[3]),h=h.replace(d[0],"");var j=i.length,k=function(){0>=--j&&l()},l=function(){g=e.$compile(b),e.$$cache(a,g),c(g),j=void 0};j>0?r(s(i),function(a){e.$$cache(a)?k():e.compileByAjax(a,k,u(f,{overwrite:!1}))}):l()})}},y.prototype.renderByAjax=function(a,b,c,d){return h(b)?this.renderByAjax(a,{},b,c):void(h(c)&&this.compileByAjax(a,function(a){c(a(b||{}))},d))},x("oTemplate",function(){return new y},a)}(this);
//# sourceMappingURL=oTemplate.min.js.map