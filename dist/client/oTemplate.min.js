// oTemplate.min.js#1.0.0-beta - 2015-09-17 23:31:53
~function(a){"use strict";function b(a,b){return(a.substr(0,b).match(/\n/g)||[]).length+1}function c(a){return"Undefined"===a?function(a){return"undefined"==typeof a}:"Defined"===a?function(a){return"undefined"!=typeof a}:"Integer"===a?function(a){var b=parseInt(a,10);return!isNaN(b)&&a===b&&a.toString()===b.toString()}:"PlainObject"===a?function(a){var b,d;return!1===c("Object")(a)||c("Undefined")(a)?!1:(b=a.constructor,"function"!=typeof b?!1:(d=b.prototype,!1===c("Object")(d)?!1:!1===d.hasOwnProperty("isPrototypeOf")?!1:!0))}:function(b){return"[object "+a+"]"===Object.prototype.toString.call(b)}}function d(a){return a.replace(/^\s+|\s+$/,"")}function e(a,b,d){if(!c("String")(a))return void 0;for(var e=b,f=a.split(d||"."),g=0,h=f.length;h>g;g++){if(c("Undefined")(e[f[g]]))return void 0;e=e[f[g]]}return c("Undefined")(e)?void 0:e}function f(a){return c("String")(a)?a:c("Number")(a)?a+="":c("Function")(a)?f(a.call(a)):""}function g(a){return a.replace(/("|'|\\)/g,"\\$1").replace(/\r/g,"\\r").replace(/\n/g,"\\n")}function h(a){return f(a).replace(/&(?![\w#]+;)|[<>"']/g,h.escapeFn)}function i(a,b){if(c("Function")(b)){var d;if(c("Array")(a))if(Array.prototype.some)a.some(b);else{var e=a.length;for(d=0;e>d&&!0!==b(a[d],d);d++);}else if(c("Object")(a))for(d in a)if(!0===b(a[d],d))break}}function j(a){for(var b={},c=[],d=a.length;d--;)b.hasOwnProperty(a[d])||(c.push(a[d]),b[a[d]]=1);return c}function k(a,b){var d=c("Array")(a),e=d?[]:{};return i(a,function(a,c){b(a,c)&&(e[d?e.length:c]=a)}),e}function l(a,b){if(arguments.length>2){a=l(a,b);var d=Array.prototype.slice.call(arguments,2,arguments.length);return l(a,d[0])}if(c("Array")(a)&&c("Array")(b))Array.prototype.splice.apply(a,[a.length,0].concat(b));else if(c("PlainObject")(a)&&c("PlainObject")(b))for(var e in b)a[e]=b[e];return a}function m(a,b){function d(a){setTimeout(function(){throw a})}b=c("String")(b)?b:"log";var e="";return c("Object")(a)?i(a,function(a,b){e+="<"+b.substr(0,1).toUpperCase()+b.substr(1)+">\n"+a+"\n\n"}):c("String")(a)&&(e=a),"log"===b?c("Defined")(console)&&c("Function")(console.error)?console.error(e):d(e):"catch"===b&&d(e),e}function n(){return""}function o(a,b,c){"function"==typeof define?define(function(){return b(c)}):"object"==typeof exports?module.exports=b(c):c[a]=b(c)}var p=function(a){a=a||{};var b=this;this._caches={},this._blocks={},this._blockHelpers={},this._sourceHelpers={},this._helpers={},this._defaults={},this._listeners=[],~l(this._defaults,p._defaults,a),~l(this._helpers,{$escape:function(){return h.apply(h,arguments)},$noescape:function(a){return f(a||"")},$toString:function(a,d){var e=b._defaults,a=f(a);return!0===(c("Boolean")(d)?d:e.escape)?b.helper("$escape")(a):a},include:function(a,c,d){var e=(b._defaults,document.getElementById(a));return e?(b.$$throw({message:"[Include Error]: Template ID `"+a+"` is not found."}),""):b.render(e.innerHTML,c,d)}}),~c("Array")(p._extends)&&i(p._extends,function(a){b["extends"](a)})};p.ENV=p.prototype.ENV={PRODUCE:1,DEVELOP:2,UNIT:3},p._defaults={env:p.ENV.PRODUCE,noSyntax:!1,strict:!0,compress:!0,escape:!0,openTag:"{{",closeTag:"}}",depends:[]},p._extends=[],p.extend=function(a){return c("Function")(a)&&p._extends.push(a),this},p.prototype.$$throw=function(a,b){var c=l({},this._defaults,b),d=m(a,c.env===p.ENV.UNIT&&"catch");i(this._listeners,function(a){"error"===a.type&&handle(d)})},p.prototype.on=function(a,b){return c("String")(a)&&c("Function")(b)&&this._listeners.push({type:a,handle:b}),this},p.prototype.onError=function(a){return this.on("error",a)},p.prototype.$$cache=function(a,b){var c=this._caches;return arguments.length>1?(c[a]=b,this):c[a]},p.prototype.$$table=function(){function a(a,b,c){c=c||" ",a=a.toString(),b=b.toString().replace(/\d/g,c);var d=b.split("");return d.splice(-a.length,a.length,a),d.join("")}return function(b){var c=0,d=b.match(/([^\n]*)?\n|([^\n]+)$/g);if(!d)return c+" | "+b;var e=d.length;return b.replace(/([^\n]*)?\n|([^\n]+)$/g,function(b){return a(++c,e)+" | "+b})}}(),p.prototype.$compileShell=function(){function b(a){var b=["$scope","$helpers","$blocks","$data","$buffer","$runtime","$append","abstract","arguments","break","boolean","byte","case","catch","char","class","continue","console","const","debugger","default","delete","do","double","else","enum","export","extends","false","final","finally","float","for","function","goto","if","implements","import","in","instanceof","int","interface","let","long","native","new","null","package","private","protected","public","return","short","static","super","switch","synchronized","this","throw","throws","transient","true","try","typeof","undefined","var","void","volatile","while","with","yield"],c=a.replace(/\\?\"([^\"])*\\?\"|\\?\'([^\'])*\\?\'|\/\*[\w\W]*?\*\/|\/\/[^\n]*\n|\/\/[^\n]*$|\s*\.\s*[$\w\.]+/g,"").replace(/[^\w$]+/g,",").replace(/^\d[^,]*|,\d[^,]*|^,+|,+$/g,"").split(/^$|,+/);return k(c,function(a){return-1===b.indexOf(a)})}return function(e,f){f=f||{};var h=e,k=this._defaults,l=c("Boolean")(f.escape)?f.escape:k.escape,m=c("Boolean")(f.compress)?f.compress:k.compress,n=this._helpers,o=this._blockHelpers,p=this._sourceHelpers,q=[],r=[],s=[],t=1,u="",v=function(a){for(var b,c,d;c=/<%source\\s*([\w\W]+?)?\\s*%>(.+?)<%\/source%>/gim.exec(a);)b=c[1],d=c[2],d=b&&p.hasOwnProperty(b)?p[b](d):d,d='<%=unescape("'+escape(d)+'");%>',a=a.replace(c[0],d);return a},w=function(a){return a=a.replace(/<!--[\w\W]*?-->/g,"").replace(/^ +$/,""),""===a?"":(t+=a.split(/\n/).length-1,a=a.replace(/(["'\\])/g,"\\$1"),a=!0===m?a.replace(/[\r\t\n]/g,"").replace(/ +/g," "):a.replace(/\t/g,"\\t").replace(/\r/g,"\\r").replace(/\n/g,"\\n"),'$buffer+="'+a+'";')},x=function(e){return e=d(e||""),i(b(e),function(b){if(b){var d=a[b];if(!c("Function")(d)||!d.toString().match(/^\s*?function \w+\(\) \{\s*?\[native code\]\s*?\}\s*?$/i))return c("Function")(n[b])?void q.push(b):c("Function")(o[b])?void r.push(b):void s.push(b)}}),/^=\s*[\w\W]+?\s*$/.exec(e)?e="$buffer+=$helpers.$toString("+e.replace(/[=\s;]/g,"")+", "+l+");":/^#\s*[\w\W]+?\s*$/.exec(e)?e="$buffer+=$helpers.$noescape("+e.replace(/[#\s;]/g,"")+");":/^!#\s*[\w\W]+?\s*$/.exec(e)?e="$buffer+=$helpers.$escape("+e.replace(/[!#\s;]/g,"")+");":/^\s*([\w\W]+)\s*\([^\)]*?\)\s*$/.exec(e)&&(e="$buffer+=$helpers.$toString("+e+", "+l+");"),t+=e.split(/\n|%0A/).length-1,e+=(/\)$/.exec(e)?";":"")+"$runtime="+t+";"};return e=c("String")(e)?v(e):"",i(e.split("<%"),function(a){a=a.split("%>");var b=a[0],c=a[1];1===a.length?u+=w(b):(u+=x(b),u+=w(c))}),i(j(s),function(a){u="var "+a+"=$data."+a+";"+u}),i(j(q),function(a){u="var "+a+"=$helpers."+a+";"+u}),i(j(r),function(a){u="var "+a+"=$blocks."+a+";"+u}),u='try {"use strict";var $scope=this,$helpers=$scope.$helpers,$blocks=$scope.$blocks,$buffer="",$runtime=0;'+u+'return $buffer;}catch(err) {throw {Message: err.message,Line: $runtime,Shell: "'+g(this.$$table(h))+'"};}function $append(buffer) {$buffer += buffer;}'}}(),p.prototype.$compile=function(){return function(a,b){function c(b){var c;try{c=new Function(h,k)}catch(f){d.$$throw({message:"[Compile Render]: "+f.message,line:"Javascript syntax occur error, it can not find out the error line.",syntax:e,template:a,shell:k}),c=n}return function(a){try{return c.apply(b,[a].concat(j))}catch(e){e=l({},e,{source:d.$$table(b.$source)}),d.$$throw({message:"[Exec Render]: "+e.message,line:e.line,template:e.source,shell:e.shell})}}}var d=this,e=a,f=l({},this._defaults,b),g=f.depends,h=["$data"].concat(g).join(","),j=[];~i(g,function(a){"$"===a.charAt(0)?(a=a.replace("$",""),j.push(f[a])):j.push(void 0)}),!0!==f.noSyntax&&(a=this.$compileSyntax(a,!!f.strict));var k=this.$compileShell(a,f);return c({$source:a||"",$helpers:this._helpers||{},$blocks:this._blockHelpers||{}})}}(),p.prototype.OTemplate=function(a){return new p(a)},p.prototype["extends"]=function(a){return a.call(this,this),this},p.prototype.config=function(a,b){if(1<arguments.length&&c("String")(a))return"openTag"===a&&"<%"===a||"closeTag"===a&&"%>"===a?this:(this._defaults[a]=b,this);var d=this;return c("PlainObject")(a)?(i(options,function(a,b){d.config(a,b)}),this):c("String")(a)?this._defaults[a]:void 0},p.prototype.helper=function(a,b){if(1<arguments.length)c("String")(a)&&c("Function")(b)&&(this._helpers[a]=b);else{if(c("String")(a))return this._helpers[a];if(c("PlainObject")(a)){var d;for(d in a)this.helper(d,a[d])}}return this},p.prototype.unhelper=function(a){var b=this._helpers;return b.hasOwnProperty(a)&&delete b[a],this},p.prototype.compile=function(a,b){a=a.toString();var d=l({},this._defaults,b),e=d.filename,f=!0===d.overwrite||this.$$cache(e);return c("Function")(f)?f:(f=this.$compile(a,d),c("String")(e)&&this.$$cache(e,f),f)},p.prototype.render=function(a,b,c){return this.compile(a,c)(b||{})},p._defaults=l(p._defaults,{noSyntax:!1}),p.prototype.$$compile=function(a,b){return b=c("PlainObject")(b)?b:this._defaults,a.replace(/<%=\s*([^\s]+?)\s*%>/gim,function(a,c){return e(c,b)||""})},p.prototype.$$compileRegexp=function(a,b){var c=this.$$compile(a);return new RegExp(c,b)},p.prototype.$registerSyntax=function(a,b,d){var e=this;return 2<arguments.length?this._blocks[a]={syntax:c("RegExp")(b)?b:this.$$compileRegexp("<%= openTag %>"+b+"<%= closeTag %>","igm"),shell:c("Function")(d)?d:"<%"+this.$$compile(d)+"%>"}:c("PlainObject")(b)?i(b,function(b,c){e.$registerSyntax(a,c,b)}):c("Array")(b)&&i(b,function(b){c("String")(b.syntax)&&c("String")(b.shell)||c("Function")(b.shell)&&e.$registerSyntax(a,b.syntax,b.shell)}),this},p.prototype.$unregisterSyntax=function(a){var b=this._blocks;return b.hasOwnProperty(a)&&delete b[a],this},p.prototype.$clearSyntax=function(a){var b=this.$$compileRegexp("<%= openTag %>(.*)?<%= closeTag %>","igm");return a.replace(b,"")},p.prototype.$analyzeSyntax=function(a,c,d){d=d||"",c=!(!1===c);var e=a;c&&i(this._blocks,function(a){e=e.replace(a.syntax,"")});var f=this.$$compileRegexp("<%= openTag %>|<%= closeTag %>","igm"),g=this.$clearSyntax(e);if(l=g.search(f),-1!==l){var h=b(g,l);return{message:"[Syntax Error]: Syntax error in line "+h+".",syntax:this.$$table(d)}}var j=this.$$compileRegexp("<%= openTag %>(.*)?<%= closeTag %>","igm"),k=a.match(j);if(k){var l=e.search(j),h=b(e,l);return{message:"[Syntax Error]: `"+k[0]+"` did not match any syntax in line "+h+".",syntax:this.$$table(e)}}return!0},p.prototype.$compileSyntax=function(a,b){b=!(!1===b);var c,d=a;this._defaults;return i(this._blocks,function(b){a=a.replace(b.syntax,b.shell)}),b?!0===(c=this.$analyzeSyntax(a,!1,d))?a:this.$$throw(c)||"":this.$clearSyntax(a)},p.prototype.block=function(a,b){if(1<arguments.length)c("String")(a)&&c("Function")(b)&&(this.$registerSyntax(a+"open","("+a+")\\s*(,?\\s*([\\w\\W]+?))\\s*(:\\s*([\\w\\W]+?))?\\s*",function(a,b,c,d,e,f){return"<%"+b+"($append, "+(c?c+", ":"")+"function("+(f||"")+') {"use strict";var $buffer="";%>'}).$registerSyntax(a+"close","/"+a,"return $buffer;});")._blockHelpers[a]=function(a){var c=Array.prototype.splice.call(arguments,1);a(b.apply(this,c))});else{if(c("String")(a))return this._blockHelpers[a];if(c("PlainObject")(a)){var d;for(d in a)this.block(d,a[d])}}return this},p.prototype.unblock=function(a){var b=this._blockHelpers;return helpers.hasOwnProperty(a)&&(delete helpers[a],delete b[a+"open"],delete b[a+"close"]),this},p.extend(function(){var a="(!?#?)\\s*([^\\|]+?)\\s*\\|\\s*([^:]+?)\\s*(:\\s*([^\\|]+?))?\\s*(\\|\\s*[\\w\\W]+?)?",b=(this.$$compileRegexp(a),"\\s*([\\w\\W]+?\\s*\\([\\w\\W]+?\\))\\s*\\|\\s*([^:]+?)\\s*(:\\s*([^\\|]+?))?$"),c=this.$$compileRegexp(b);this.$registerSyntax("echo","@\\s*([^|]+?)\\s*","=$1").$registerSyntax("ifopen","if\\s*(.+?)\\s*","if($1) {").$registerSyntax("else","else","} else {").$registerSyntax("elseif","else\\s*if\\s*(.+?)\\s*","} else if($1) {").$registerSyntax("ifclose","\\/if","}").$registerSyntax("eachopen","each\\s*([\\w\\W]+?)\\s*(as\\s*(\\w*?)\\s*(,\\s*\\w*?)?)?\\s*",function(a,b,c,d,e){var f="each("+b+", function("+(d||"$value")+(e||", $index")+") {";return"<%"+f+"%>"}).$registerSyntax("eachclose","\\/each","})").$registerSyntax("include","include\\s*([\\w\\W]+?)\\s*(,\\s*[\\w\\W]+?)?\\s*",function(a,b,c){return"<%#include("+b+(c||", $data")+")%>"}).$registerSyntax("noescape","#\\s*([^|]+?)\\s*","#$1").$registerSyntax("escape","!#\\s*([^|]+?)\\s*","!#$1").$registerSyntax("helper",a,function(){function a(a,b,c,e,f,g,h){return e+"("+d(c)+(g?","+g:"")+")"+(h?h.replace(/^\s*$/,""):"")}function b(a,b,c,d,e){return c+"("+b+","+e+")"}return function(d,e,g,h,i,j,k){for(var l=a.apply(this,arguments);c.exec(l);)l=l.replace(c,b);return"<%"+f(e)+l+"%>"}}()),~l(this._helpers,{each:function(a,b){i(a,b)}})}),p.extend(function(){var a=this;~l(this._helpers,{include:function(b,c,d){return a.renderById(b,c,d)}})}),p.prototype.compileById=function(a,b){a=a.toString();var d=l({},this._defaults,b,{filename:a}),e=!0===d.overwrite||this.$$cache(a);if(c("Function")(e))return e;var f=document.getElementById(a);return f?this.compile(f.innerHTML,d):(this.$$throw({message:"[Compile Template]: Template ID `"+a+"` is not found."}),n)},p.prototype.renderById=function(a,b,c){var d=this.compileById(a,c);return d(b||{})},p.prototype.compileByAjax=function(a,b,d){if(c("Function")(b)){var e=this,f=l({},this._defaults,d),g=!0===f.overwrite||this.$$cache(a);c("Function")(g)?b(g):this.readFile(a,function(c){c=e.$compileSyntax(c,!!f.strict);for(var d,h=c,k=[];d=/<%!?#?\s*include\s*\(\s*(\'([^\']+)?\'|\"([^\"]+)?\")(\s*,\s*([^\)]+)?)\)%>/.exec(c);)k.push(d[3]),c=c.replace(d[0],"");var m=k.length,n=function(){0>=--m&&o()},o=function(){g=e.$compile(h),e.$$cache(a,g),b(g),m=void 0};m>0?i(j(k),function(a){e.$$cache(a)?n():e.compileByAjax(a,n,l(f,{overwrite:!1}))}):o()})}},p.prototype.renderByAjax=function(a,b,d,e){return c("Function")(b)?this.renderByAjax(a,{},b,d):void(c("Function")(d)&&this.compileByAjax(a,function(a){d(a(b||{}))},e))},p.prototype.readFile=function(a,b,d){if(c("Function")(b)){var e=this,f=new XMLHttpRequest;f.onreadystatechange=function(){var a=this.status;this.DONE===this.readyState&&a>=200&&400>a&&b(this.responseText)},f.onerror=function(){var b={message:"[Compile Template]: Request file `"+a+"` some error occured.",filename:a,response:"[Reponse State]: "+this.status};e.$$throw(b),c("Function")(d)&&d(b),d=void 0},f.ontimeout=function(){var b={message:"[Request Template]: Request template file `"+a+"` timeout.",filename:a};e.$$throw(b),c("Function")(d)&&d(b),d=void 0},f.onabort=function(){var b={message:"[Request Template]: Bowswer absort the request.",filename:a};e.$$throw(b),c("Function")(d)&&d(b),d=void 0},f.open("GET",a,!0),f.send(null)}},h.SOURCES={"<":"&lt;",">":"&gt;","&":"&amp;",'"':"&quot;","'":"&#x27;","/":"&#x2f;"},h.escapeFn=function(a){return h.SOURCES[a]},o("oTemplate",function(){return new p},a)}(this);
//# sourceMappingURL=oTemplate.min.js.map