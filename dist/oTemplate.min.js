// oTemplate.min.js#1.0.0-pre - 2015-09-02 00:49:45
~function(a){"use strict";function b(a,b){return(a.substr(0,b).match(/\n/g)||[]).length+1}function c(a){return Object.prototype.toString.call(a)}function d(a){return"[object String]"===c(a)}function e(a){return"[object Boolean]"===c(a)}function f(a){return"[object Number]"===c(a)}function g(a){return"[object Object]"===c(a)}function h(a){return"[object Function]"===c(a)}function i(a){return"undefined"!=typeof a}function j(a){return"undefined"==typeof a}function k(a){return"[object Array]"===c(a)}function l(a){var b,c;return!1===g(a)||j(a)?!1:(b=a.constructor,"function"!=typeof b?!1:(c=b.prototype,!1===g(c)?!1:!1===c.hasOwnProperty("isPrototypeOf")?!1:!0))}function m(a,b,c){if(!d(a))return void 0;for(var e=b,f=a.split(c||"."),g=0,h=f.length;h>g;g++){if(j(e[f[g]]))return void 0;e=e[f[g]]}return j(e)?void 0:e}function n(a){return d(a)?a:f(a)?a+="":h(a)?n(a.call(a)):""}function o(a){return a.replace(/("|'|\\)/g,"\\$1").replace(/\r/g,"\\r").replace(/\n/g,"\\n")}function p(a,b){if(h(b)){var c;if(k(a))if(Array.prototype.some)a.some(b);else{var d=a.length;for(c=0;d>c&&!0!==b(a[c],c);c++);}else if(g(a))for(c in a)if(!0===b(a[c],c))break}}function q(a){for(var b={},c=[],d=a.length;d--;)b.hasOwnProperty(a[d])||(c.push(a[d]),b[a[d]]=1);return c}function r(a,b){if(arguments.length>2){a=r(a,b);var c=Array.prototype.slice.call(arguments,2,arguments.length);return r(a,c[0])}if(k(a)&&k(b))Array.prototype.splice.apply(a,[a.length,0].concat(b));else if(l(a)&&l(b))for(var d in b)a[d]=b[d];return a}function s(a){if(i(console)&&h(console.error)){var b="";g(a)?p(a,function(a,c){b+="<"+c+">\n"+a+"\n\n"}):d(a)&&(b=a),console.error(b)}}function t(a,b,c){"function"==typeof define?define(function(){return b(c)}):"object"==typeof exports?module.exports=b(c):c[a]=b(c)}var u=function(a){a=a||{},this._caches={},this._blocks={},this._helpers={},this._defaults={},r(this._defaults,u._defaults,a),h(u._extends)&&this["extends"](u._extends),~r(this._helpers,{include:function(a,b,c){return this.render(a,b,c)},each:function(a,b){p(a,b)},escape:function(){var a={};return a.SOURCES={"<":"&lt;",">":"&gt;","&":"&amp;",'"':"&quot;","'":"&#x27;","/":"&#x2f;"},a.escapeFn=function(a){return this.SOURCES[a]},a.escape=function(a){return n(a).replace(/&(?![\w#]+;)|[<>"']/g,this.escapeFn)},function(){return a.escape.apply(a,arguments)}}()})};u._defaults={env:"produce",noSyntax:!1,strict:!0,compress:!0,openTag:"{{",closeTag:"}}",cache:!0,depends:[]},u.prototype.$$throw=function(a){"unit"!==this._defaults.env&&s(a)},u.prototype.$$cache=function(a,b){var c=this._caches;return arguments.length>1?(c[a]=b,this):c[a]},u.prototype.$$table=function(a){var b=0;return a.replace(/([^\n]*)?\n|([^\n]+)$/g,function(a){return++b+":"+a})},u.prototype.$compileShell=function(b,c){function d(a){return a=a.replace(/<!--[\w\W]*?-->/g,"").replace(/^ +$/,""),""===a?"":(m+=a.split(/\n/).length-1,a=a.replace(/(["'\\])/g,"\\$1"),a=!0===c?a.replace(/[\r\t\n]/g,"").replace(/ +/g," "):a.replace(/\t/g,"\\t").replace(/\r/g,"\\r").replace(/\n/g,"\\n"),'$buffer+="'+a+'";')}function f(a){return g(a),/^\s*\w+\s*\([^\)]*?\)\s*$/.exec(a)&&(a="$buffer+="+a+'||"";'),m+=a.split(/\n/).length-1,a+="$runtime="+m+";"}function g(b){return p(i(b),function(b){if(b){var c=a[b];if(!h(c)||!c.toString().match(/^\s*?function \w+\(\) \{\s*?\[native code\]\s*?\}\s*?$/i))return h(j[b])?void k.push(b):void l.push(b)}}),[k,l]}function i(a){var b=["$data","$helper","$buffer","$runtime","abstract","arguments","break","boolean","byte","case","catch","char","class","continue","console","const","debugger","default","delete","do","double","else","enum","export","extends","false","final","finally","float","for","function","goto","if","implements","import","in","instanceof","int","interface","let","long","native","new","null","package","private","protected","public","return","short","static","super","switch","synchronized","this","throw","throws","transient","true","try","typeof","undefined","var","void","volatile","while","with","yield"];return a.replace(/\\?\"([^\"])*\\?\"|\\?\'([^\'])*\\?\'|\/\*[\w\W]*?\*\/|\/\/[^\n]*\n|\/\/[^\n]*$|\s*\.\s*[$\w\.]+/g,"").replace(/[^\w$]+/g,",").replace(new RegExp("\\b"+b.join("\\b|\\b")+"\\b","g"),"").replace(/^\d[^,]*|,\d[^,]*|^,+|,+$/g,"").split(/^$|,+/)}c=e(c)?c:this._defaults.compress;var j=this._helpers,k=[],l=[],m=1,n="";return b=b||"",p(b.split("<%"),function(a){a=a.split("%>");var b=a[0],c=a[1];1===a.length?n+=d(b):(n+=f(b),n+=d(c))}),p(q(l),function(a){n="var "+a+"=$data."+a+";"+n}),p(q(k),function(a){n="var "+a+"=$helpers."+a+";"+n}),n='try {"use strict";var $scope=this,$helpers=$scope.$helpers,$buffer="",$runtime=0;'+n+'return $buffer;} catch(err) {throw {message: err.message,line: $runtime,shell: "'+o(this.$$table(b))+'"};}'},u.prototype.$compile=function(a,b){function c(b,c,d){var e;try{e=new Function(c,b)}catch(f){s({message:"[Build Render]: "+f.message,line:"Anonymous function can not find out the error line.",template:a,shell:b}),e=function(){return""}}return function(){try{return e.apply(d,arguments)}catch(a){a=r({},a,{source:d.$source}),s({message:"[Exec Render]: "+a.message,line:a.line,source:a.source,shell:a.shell})}}}var d=a,e=r({},this._defaults,b),f=["$data"].concat(e.depends).join(",");!0!==e.noSyntax&&(a=this.$compileSyntax(a,!!e.strict));var g=this.$compileShell(a);return c(g,f,{$source:this.$$table(d),$helpers:this._helpers})},u.prototype.$render=function(a,b,c){var d=this.$compile(a,c);return d(b)},u.prototype.OTemplate=function(a){return new u(a)},u.prototype["extends"]=function(a){return a.call(this,this),this},u.prototype.config=function(a,b){if(1<arguments.length&&d(a))return"openTag"===a&&"<%"===a||"closeTag"===a&&"%>"===a?this:(this._defaults[a]=b,this);var c=this;return l(a)?(each(options,function(a,b){c.config(a,b)}),this):d(a)?this._defaults[a]:void 0},u.prototype.block=function(a,b){if(1<arguments.length)d(a)&&h(b)&&(this.$registerSyntax(a+"open",a+"\\s*([^<%= closeTag %>]*?)\\s*(as\\s*(\\w*?)\\s*(,\\s*\\w*?)?)?\\s*",a+"($1, function($3$4) {").$registerSyntax(a+"close","/"+a,"})")._helpers[a]=b);else{if(d(a))return this._helpers[a];if(l(a)){var c;for(c in a)this.block(c,a[c])}}return this},u.prototype.unblock=function(a){var b=this._blocks;return helpers.hasOwnProperty(a)&&(delete helpers[a],delete b[a+"open"],delete b[a+"close"]),this},u.prototype.helper=function(a,b){if(1<arguments.length)d(a)&&h(b)&&(this._helpers[a]=b);else{if(d(a))return this._helpers[a];if(l(a)){var c;for(c in a)this.helper(c,a[c])}}return this},u.prototype.unhelper=function(a){var b=this._helpers;return b.hasOwnProperty(a)&&delete b[a],this},u.prototype.compile=function(a,b,c){var d=r({},this._defaults,c),e=this.$$cache(a);h(e)?b(e):readFile(a,function(c){e=this.$compile(c),!0===d.cache&&this.$$cache(a,e),b(e)})},u.prototype.render=function(a,b,c,d){},u._defaults=r(u._defaults,{noSyntax:!0}),u._extends=function(){this.$registerSyntax("ifopen","if\\s*(.+)?\\s*","if($1) {").$registerSyntax("else","else","} else {").$registerSyntax("elseif","else\\s*if\\s*(.+)?\\s*","} else if($1) {").$registerSyntax("ifclose","\\/if","}").$registerSyntax("eachopen","each\\s*([^\\s]+)?\\s*(as\\s*(\\w*?)\\s*(,\\s*\\w*?)?)?\\s*","each($1, function($3$4) {").$registerSyntax("eachclose","\\/each","})").$registerSyntax("include","include\\s*([^\\s,]+)?\\s*(,\\s*[^\\s+]+)?\\s*","include($1$2)").$registerSyntax("escape","#\\s*([^\\s]+)?\\s*","escape($1)").$registerSyntax("helper","\\s*(\\w*\\s*\\()*([^<%= closeTag %>]*?)\\s*\\|\\s*([\\w]*?)\\s*(:\\s*([,\\w]*?))?(\\))*\\s*","$3(<%= openTag %>$2<%= closeTag %>,$5)",!0)},u.prototype.$$compile=function(a,b){return b=l(b)?b:this._defaults,a.replace(/<%=\s*([^\s]+)?\s*%>/gim,function(a,c){return m(c,b)||""})},u.prototype.$$compileRegexp=function(a,b){var c=this.$$compile(a);return new RegExp(c,b)},u.prototype.$registerSyntax=function(a,b,c,e){var f=this;return 2<arguments.length?this._blocks[a]={syntax:this.$$compileRegexp("<%= openTag %>"+b+"<%= closeTag %>","igm"),shell:"<%"+this.$$compile(c)+"%>",repeat:!0===e}:l(b)?p(b,function(b,c){f.$registerSyntax(a,c,b)}):k(b)&&p(b,function(b){d(b.syntax)&&d(b.shell)&&f.$registerSyntax(a,b.syntax,b.shell)}),this},u.prototype.$unregisterSyntax=function(a){var b=this._blocks;return b.hasOwnProperty(a)&&delete b[a],this},u.prototype.$clearSyntax=function(a){var b=this.$$compileRegexp("<%= openTag %>(.*)?<%= closeTag %>","igm");return a.replace(b,"")},u.prototype.$analyzeSyntax=function(a,c){c=!(!1===c);var d=a;c&&p(this._blocks,function(a){d=d.replace(a.syntax,"")});var e=this.$$compileRegexp("<%= openTag %>|<%= closeTag %>","igm"),f=this.$clearSyntax(d);if(j=f.search(e),-1!==j){var g=b(f,j);return{message:"[Syntax Error]: Syntax error in line "+g+".",template:this.$$table(a)}}var h=this.$$compileRegexp("<%= openTag %>(.*)?<%= closeTag %>","igm"),i=a.match(h);if(i){var j=d.search(h),g=b(d,j);return{message:"[Syntax Error]: `"+i[0]+"` did not match any syntax in line "+g+".",template:this.$$table(d)}}return!0},u.prototype.$compileSyntax=function(a,b){b=!(!1===b);var c,d;this._defaults;return p(this._blocks,function(b){var c=a.replace(b.syntax,b.shell);if(b.repeat)for(;a!==c;)a=c,c=a.replace(b.syntax,b.shell);a=c}),c=a.replace(/<%(.*)(<%)+?(.*)(%>)+?(.*)%>/gim,"<%$1$3$5%>").replace(this.$$compileRegexp("<%(.*)?<%= openTag %>(.*)?<%= closeTag %>(.*)?%>","igm"),"<%$1$2$3%>"),b?!0===(d=this.$analyzeSyntax(c,!1))?c:this.$$throw(d)||"":this.$clearSyntax(c)},t("oTemplate",function(){return new u},a)}(this);
//# sourceMappingURL=oTemplate.min.js.map